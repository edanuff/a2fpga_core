*
* Tool221
* by Ninjaforce
* Visit ninjaforce.com
*
* Based on Tool219
* by FTA & ESP, 1990
* See disclaimer below
* Visit freetoolsassociation.com
*
* Some changes by
* Brutal Deluxe Software, 2015
* Visit brutaldeluxe.fr
*
* 4soniq support by
* Brutal Deluxe Sofware, 2016
*

FineTuneCnvrt dw 0,2,4,6,8,10,12,14,0-16,0-14,0-12,0-10,0-8,0-6,0-4,0-2

BlockTable = *
          dw Nb_Track*64*0
          dw Nb_Track*64*1
          dw Nb_Track*64*2
          dw Nb_Track*64*3
          dw Nb_Track*64*4
          dw Nb_Track*64*5
          dw Nb_Track*64*6
          dw Nb_Track*64*7
          dw Nb_Track*64*8
          dw Nb_Track*64*9
          dw Nb_Track*64*10
          dw Nb_Track*64*11
          dw Nb_Track*64*12
          dw Nb_Track*64*13
          dw Nb_Track*64*14
          dw Nb_Track*64*15
          dw Nb_Track*64*16
          dw Nb_Track*64*17
          dw Nb_Track*64*18
          dw Nb_Track*64*19
          dw Nb_Track*64*20
          dw Nb_Track*64*21
          dw Nb_Track*64*22
          dw Nb_Track*64*23
          dw Nb_Track*64*24
          dw Nb_Track*64*25
          dw Nb_Track*64*26
          dw Nb_Track*64*27
          dw Nb_Track*64*28
          dw Nb_Track*64*29
          dw Nb_Track*64*30
          dw Nb_Track*64*31
          dw Nb_Track*64*32
          dw Nb_Track*64*33
          dw Nb_Track*64*34
          dw Nb_Track*64*35
          dw Nb_Track*64*36
          dw Nb_Track*64*37
          dw Nb_Track*64*38
          dw Nb_Track*64*39
          dw Nb_Track*64*40
          dw Nb_Track*64*41
          dw Nb_Track*64*42
          dw Nb_Track*64*43
          dw Nb_Track*64*44
          dw Nb_Track*64*45
          dw Nb_Track*64*46
          dw Nb_Track*64*47
          dw Nb_Track*64*48
          dw Nb_Track*64*49
          dw Nb_Track*64*50

StereoMode dw $FFFF

InstIndexTable = *
          dw 12*0
          dw 12*1
          dw 12*2
          dw 12*3
          dw 12*4
          dw 12*5
          dw 12*6
          dw 12*7
          dw 12*8
          dw 12*9
          dw 12*10
          dw 12*11
          dw 12*12
          dw 12*13
          dw 12*14
          dw 12*15

VolumeConversion dfb 0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30
          dfb 32,34,36,38,40,42,44,46,48,50,52,54,56,58,60,62,64,66,68,70
          dfb 72,74,76,78,80,82,84,86,88,90,92,94,96,98,100,102,104,106
          dfb 108,110,112,114,116,118,120,122,124,126,128,130,132,134,136
          dfb 138,140,142,144,146,148,150,152,154,156,158,160,162,164,166
          dfb 168,170,172,174,176,178,180,182,184,186,188,190,192,194,196
          dfb 198,200,202,204,206,208,210,212,214,216,218,220,222,224,226
          dfb 228,230,232,234,236,238,240,242,244,246,248,250,252,254,255
          dfb 255

                         ;FreqTable dw $00,$16,$17,$18,$1A,$1B,$1D,$1E,$20,$22,$24,$26 ; Octave 0
                         ; dw $29,$2B,$2E,$31,$33,$36,$3A,$3D,$41,$45,$49,$4D ; Octave 1
                         ; dw $52,$56,$5C,$61,$67,$6D,$73,$7A,$81,$89,$91,$9A ; Octave 2
                         ;
                         ; dw 81,86,91,97,103,109,115,122,129,137,145,154
                         ; dw 163,172,183,193,205,218,231,244,259,274,290,308
                         ; dw 325,345,366,387,410,435,461,487,516,548,580,616
                         ;
                         ; dw $0A3,$0AD,$0B7,$0C2,$0CE,$0D9,$0E6,$0F4,$102,$112,$122,$133 ; Octave 3
                         ; dw $146,$15A,$16F,$184,$19B,$1B4,$1CE,$1E9,$206,$225,$246,$269 ; Octave 4
                         ; dw $28D,$2B4,$2DD,$309,$337,$368,$39C,$3D3,$40D,$44A,$48C,$4D1 ; Octave 5
                         ; dw $51A,$568,$5BA,$611,$66E,$6D0,$737,$7A5,$81A,$895,$918,$9A2 ; Octave 6
                         ; dw $A35,$AD0,$B75,$C23,$CDC,$D9F,$E6F,$F4B,$1033,$112A,$122F,$1344 ; Octave 7
                         ; dw $1469,$15A0,$16E9,$1846,$19B7,$1B3F
                         ; dw $1CDE,$1E95,$2066,$2254,$245E,2688 ; Octave 8

          dw 80,80,80,80,80,80,80,80,80,80,80,80
          dw 80,80,80,80,80,80,80,80,80,80,80,80
          dw 80,80,80,80,80,80,80,80,80,80,80,80
          dw 81,81,81,81,81,81,81,81,81,81,81,81
FineTuneTbl dw 81,81,81,81,81,81,81,82,82,82,82,82
          dw 82,82,82,82,82,82,83,83,83,83,83,83
          dw 83,83,83,83,84,84,84,84,84,84,84,84
          dw 84,85,85,85,85,85,85,85,85,85,85,86
          dw 86,86,86,86,86,86,86,86,87,87,87,87
          dw 87,87,87,87,87,88,88,88,88,88,88,88
          dw 88,88,89,89,89,89,89,89,89,89,89,90
          dw 90,90,90,90,90,90,90,91,91,91,91,91
          dw 91,91,91,91,92,92,92,92,92,92,92,92
          dw 93,93,93,93,93,93,93,93,94,94,94,94
          dw 94,94,94,94,95,95,95,95,95,95,95,96
          dw 96,96,96,96,96,96,96,97,97,97,97,97
          dw 97,97,98,98,98,98,98,98,98,99,99,99
          dw 99,99,99,99,100,100,100,100,100,100,100,101
          dw 101,101,101,101,101,101,102,102,102,102,102,102
          dw 103,103,103,103,103,103,103,104,104,104,104,104
          dw 104,105,105,105,105,105,105,105,106,106,106,106
          dw 106,106,107,107,107,107,107,107,108,108,108,108
          dw 108,108,109,109,109,109,109,110,110,110,110,110
          dw 110,111,111,111,111,111,111,112,112,112,112,112
          dw 113,113,113,113,113,113,114,114,114,114,114,115
          dw 115,115,115,115,116,116,116,116,116,117,117,117
          dw 117,117,118,118,118,118,118,119,119,119,119,119
          dw 120,120,120,120,120,121,121,121,121,121,122,122
          dw 122,122,123,123,123,123,123,124,124,124,124,125
          dw 125,125,125,125,126,126,126,126,127,127,127,127
          dw 128,128,128,128,128,129,129,129,129,130,130,130
          dw 130,131,131,131,131,132,132,132,132,133,133,133
          dw 133,134,134,134,134,135,135,135,136,136,136,136
          dw 137,137,137,137,138,138,138,138,139,139,139,140
          dw 140,140,140,141,141,141,142,142,142,142,143,143
          dw 143,144,144,144,145,145,145,145,146,146,146,147
          dw 147,147,148,148,148,149,149,149,150,150,150,151
          dw 151,151,152,152,152,153,153,153,154,154,154,155
          dw 155,155,156,156,156,157,157,157,158,158,158,159
          dw 159,160,160,160,161,161,161,162,162,163,163,163
          dw 164,164,165,165,165,166,166,166,167,167,168,168
          dw 169,169,169,170,170,171,171,171,172,172,173,173
          dw 174,174,174,175,175,176,176,177,177,178,178,179
          dw 179,179,180,180,181,181,182,182,183,183,184,184
          dw 185,185,186,186,187,187,188,188,189,189,190,190
          dw 191,191,192,192,193,193,194,195,195,196,196,197
          dw 197,198,198,199,200,200,201,201,202,203,203,204
          dw 204,205,206,206,207,207,208,209,209,210,211,211
          dw 212,212,213,214,214,215,216,216,217,218,218,219
          dw 220,221,221,222,223,223,224,225,226,226,227,228
          dw 229,229,230,231,232,232,233,234,235,236,236,237
          dw 238,239,240,240,241,242,243,244,245,246,246,247
          dw 248,249,250,251,252,253,254,255,256,256,257,258
          dw 259,260,261,262,263,264,265,266,267,268,269,270
          dw 272,273,274,275,276,277,278,279,280,281,283,284
          dw 285,286,287,288,290,291,292,293,295,296,297,298
          dw 300,301,302,304,305,306,308,309,310,312,313,315
          dw 316,317,319,320,322,323,325,326,328,330,331,333
          dw 334,336,338,339,341,343,344,346,348,349,351,353
          dw 355,357,358,360,362,364,366,368,370,372,374,376
          dw 378,380,382,384,386,389,391,393,395,397,400,402
          dw 404,407,409,412,414,416,419,422,424,427,429,432
          dw 435,437,440,443,446,449,452,455,458,461,464,467
          dw 470,473,476,480,483,486,490,493,497,500,504,508
          dw 512,515,519,523,527,531,535,539,544,548,552,557
          dw 561,566,570,575,580,585,590,595,600,605,610,616
          dw 621,627,633,638,644,650,656,663,669,676,682,689
          dw 696,703,710,717,725,732,740,748,756,765,773,782

ZeroTunOffset ds 24*2
          dw 0,100,192,276,360,436,508,576,640,700,756,810
          dw 860,908,954,996,1038,1076,1112,1146,1178,1208,1236,1264
          dw 1288,1312,1336,1356,1376,1396,1414,1430,1446,1462,1476,1490
          dw 1490

TempoDiv  Dw $28
          Dw Reference_Freq/1+1
          Dw Reference_Freq/2+1
          Dw Reference_Freq/3+1
          Dw Reference_Freq/4+1
          Dw Reference_Freq/5+1
          Dw Reference_Freq/6+1
          Dw Reference_Freq/7+1
          Dw Reference_Freq/8+1
          Dw Reference_Freq/9+1
          Dw Reference_Freq/10+1
          Dw Reference_Freq/11+1
          Dw Reference_Freq/12+1
          Dw Reference_Freq/13+1
          Dw Reference_Freq/14+1
          Dw Reference_Freq/15+1

                         ; Vibrato - SchlonZ

vib_tab   dw vib0,vib1,vib2,vib3,vib4,vib5,vib6,vib7,vib8,vib9
          dw vibA,vibB,vibC,vibD,vibE,vibF

vib0      dw 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
vib1      dw 0,0,0,2,2,2,2,2,2,2,2,2,2,2,0,0,0,0,0,0-2,0-2,0-2,0-2,0-2,0-2,0-2
          dw 0-2,0-2,0-2,0-2,0,0
vib2      dw 0,0,2,2,2,4,4,4,4,4,4,4,2,2,2,0,0,0,0-2,0-2,0-2,0-4,0-4,0-4,0-4
          dw 0-4,0-4,0-4,0-2,0-2,0-2,0
vib3      dw 0,2,2,4,4,4,6,6,6,6,6,4,4,4,2,2,0,0-2,0-2,0-4,0-4,0-4,0-6,0-6,0-6
          dw 0-6,0-6,0-4,0-4,0-4,0-2,0-2
vib4      dw 0,2,4,4,6,6,8,8,8,8,8,6,6,4,4,2,0,0-2,0-4,0-4,0-6,0-6,0-8,0-8,0-8
          dw 0-8,0-8,0-6,0-6,0-4,0-4,0-2
vib5      dw 0,2,4,6,8,8,10,10,10,10,10,8,8,6,4,2,0,0-2,0-4,0-6,0-8,0-8,0-10
          dw 0-10,0-10,0-10,0-10,0-8,0-8,0-6,0-4,0-2
vib6      dw 0,2,4,6,8,10,10,12,12,12,10,10,8,6,4,2,0,0-2,0-4,0-6,0-8,0-10,0-10
          dw 0-12,0-12,0-12,0-10,0-10,0-8,0-6,0-4,0-2
vib7      dw 0,2,6,8,10,12,12,14,14,14,12,12,10,8,6,2,0,0-2,0-6,0-8,0-10,0-12
          dw 0-12,0-14,0-14,0-14,0-12,0-12,0-10,0-8,0-6,0-2
vib8      dw 0,4,6,8,12,14,14,16,16,16,14,14,12,8,6,4,0,0-4,0-6,0-8,0-12,0-14
          dw 0-14,0-16,0-16,0-16,0-14,0-14,0-12,0-8,0-6,0-4
vib9      dw 0,4,6,10,12,14,16,18,18,18,16,14,12,10,6,4,0,0-4,0-6,0-10,0-12
          dw 0-14,0-16,0-18,0-18,0-18,0-16,0-14,0-12,0-10,0-6,0-4
vibA      dw 0,4,8,12,14,16,18,20,20,20,18,16,14,12,8,4,0,0-4,0-8,0-12,0-14
          dw 0-16,0-18,0-20,0-20,0-20,0-18,0-16,0-14,0-12,0-8,0-4
vibB      dw 0,4,8,12,16,18,20,22,22,22,20,18,16,12,8,4,0,0-4,0-8,0-12,0-16
          dw 0-18,0-20,0-22,0-22,0-22,0-20,0-18,0-16,0-12,0-8,0-4
vibC      dw 0,4,10,14,16,20,22,24,24,24,22,20,16,14,10,4,0,0-4,0-10,0-14,0-16
          dw 0-20,0-22,0-24,0-24,0-24,0-22,0-20,0-16,0-14,0-10,0-4
vibD      dw 0,6,10,14,18,22,24,26,26,26,24,22,18,14,10,6,0,0-6,0-10,0-14,0-18
          dw 0-22,0-24,0-26,0-26,0-26,0-24,0-22,0-18,0-14,0-10,0-6
vibE      dw 0,6,10,16,20,24,26,28,28,28,26,24,20,16,10,6,0,0-6,0-10,0-16,0-20
          dw 0-24,0-26,0-28,0-28,0-28,0-26,0-24,0-20,0-16,0-10,0-6
vibF      dw 0,6,12,16,22,24,28,30,30,30,28,24,22,16,12,6,0,0-6,0-12,0-16,0-22
          dw 0-24,0-28,0-30,0-30,0-30,0-28,0-24,0-22,0-16,0-12,0-6


NotePlayed DS 2

Table_Son = *
          dfb $1E,$FA
Freq_L    = *-1
          dfb $3E,>$FA
Freq_H    = *-1
          dfb $5E,0      ; Volume
          dfb $9E,0      ; RamSon
          dfb $DE,0      ; Taille
          dfb $E1,$3C
          dfb $BE,$08    ; Mode FreeRun

TrackVu   ds $20
InstVu    ds $20

Clear_Deb = *

Volumina  dw 0
curr_instnum dw 0

Timer     DS 2
NumberOfBlocks DS 2
BlockIndex DS 2
BlockPlayed DS 2
NoteIndex DS 2
PositionBlock DS 2
Tempo     DS 2
InstIndex DS 2

SemitoneTbl ds Nb_Track*2
SampleTable ds Nb_Track
ArpegiattoTbl ds Nb_Track
ArpegeToneTbl ds Nb_Track*3
StartFreqTbl ds Nb_Track*2
IncFreqTbl ds Nb_Track*2
EndFreqTbl ds Nb_Track*2
TrueVolumeTbl ds Nb_Track*2
TrackTune ds Nb_Track*2

OscNumber DS 2
Temporary DS 2
Semitone  DS 2
Semitone_ DS 2
FineTune  ds 2
TempInterrupt DS 2
Temp2Interrupt DS 2
Temp3Interrupt DS 2
Temp4Interrupt DS 2
TempFreqInt DS 2
VolumeInt ds 2
CurrInstInt ds 2
Performing DS 2
LoopMode  DS 2
IndexInterrupt DS 2

ninfreqInt dw 0

SwapperMode ds $20       ;1=swap mode active

Fineslider ds $20

NinVslideup ds $20
NinVslidedwn ds $20

ninTonePsp ds $20

Vibrato_Tbl ds $20       ;ptr to the table 0=none
Vibrato_Tbl_ ds $20      ;ds
VibratoAdd_Tbl ds $20    ;add to ptr
VibratoPtr_Tbl ds $20    ;ptr in table

Ninjaloop ds 16*2        ; AV 201506
NinjaFineT ds 16*2       ; changed to 16*2
NinjaWaveAdr ds 16*2     ; from 15*2
NinjaWaveSiz ds 16*2
NinjaDocReg ds 16*2      ; ..AV 201506

VolumeTable DS $20
StereoTable DS $20
CompactTable DS $20
Instrument1 = *
instdef   DS 16*12

Clear_End = *
